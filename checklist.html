<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="checklist_style.css">
  </head>
 
  <body>
    <div class = "nav-bar">
      <div id = "logo-def">
          <a id = "logo-img" href = "index.html">
              <img src="images/logo2-1.png" alt="logo" width=270px>
          </a>
      </div>
      <div id = "prof">
          <div style = "margin-top:5px; margin-left:auto; border-radius:25px;display:flex;">
              <span id = "arrow" style = "font-size:40px; height:fit-content; margin-top:-5px; width:25px;">&#8964;</span>
              <img src="images/img.jpg" width="52px" height= "50px" style = "border-radius:25px; margin-left:8px;">
          </div>
          <div id = "drop">
              <span><a href = "trav_profile.html">Profile</a></span><br>
              <span><a href = "login.html">Log Out</a></span>
          </div>
      </div>
    </div>
    <div style = "display:flex; height:101.5vh; width:100vw; padding-top:62px; margin-left:16px; margin-bottom:-16px;">
      
      <div  id = "checklist-list">
        <div class ="checklist">+ </div>
      </div>

      <div style = "display: flex; height:90vh; width:73vw; flex-direction:column; margin-left:auto;  margin-top:10px; background-color:rgba(0, 0, 0, 0.6);">
        <div id = "use-directions" style = "margin:auto; color:white; font-size:30px; font-family:PoiretOne-Regular;"> Click on a checklist to view</div>
        <section id = "checklist-section" style = "display: none; padding:5px;">
          <div id="myDIV" class="header" style = "margin:auto;">
            <input type="text" id="myInput" placeholder="Enter item here">
            <span onclick="newElement()" class="addBtn">Add</span>
          </div>

          <div style = "margin:auto; height:80vh; width: 65vw; background-color:rgba(0, 0, 0, 0.7);">
            <ul id="myUL" style = "height:72vh; overflow-y:auto;">
            </ul>
          </div>
        </section>
      </div>

    </div>
    <script>
      var url_string = window.location.href;
      var url = new URL(url_string);
      var paramValue = url.searchParams.get("tid");

      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        //window.alert("hey");
        if (this.readyState == 4 && this.status == 200) {
          load_checklists(this.responseText);
        }
      }
      xhttp.open("GET", "GetTripChecklists?tid="+paramValue, true);
      xhttp.send();

      function load_checklists(names){
        names = names.split("\n");
        for(var i = 0; i < names.length-1; i++){
          var checks = document.getElementById("checklist-list");

          var id_name = names[i].split(",")[0];
          var cl_name = names[i].split(",")[1];
          var fns = "display_checklist();this.style.background='rgba(70,70,70,0.8)';get_contents('" + paramValue + "','"+id_name+"');";
          
          const newdiv = "<div id='" + id_name + "' class ='checklist' onclick = " + fns + ">" + cl_name + "</div>"
          checks.innerHTML = newdiv + checks.innerHTML;
        }
      }

      //document.getElementById("checklist-section").style.display = "block";
      function display_checklist(){
        document.getElementById("use-directions").style.display = "none";
        document.getElementById("checklist-section").style.display = "block";
        var ele = document.getElementsByClassName("checklist");
        for(var i = 0; i < ele.length; i++){
          ele[i].style.background = "";
        }

      }

      function get_contents(tid, cid){
        var xhttp1 = new XMLHttpRequest();
        xhttp1.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          var txt;
          var items = this.responseText.split("\n");
          for(var i = 0; i < items.length-1; i++){
            var item_name = items[i].split(",")[0];
            var stat = items[i].split(",")[1];
            var id = items[i].split(",")[2];
            //window.alert(item_name+stat + id);
            var li = "<li id = '" +id +"' class='"+stat+"'>"+item_name+"</li>";
            txt += li;
          }
          document.getElementById("myUL").innerHTML = txt;
          fn1(cid);
        }
      }
      xhttp1.open("GET", "GetChecklistDetails?cid="+cid, true);
      xhttp1.send();
      }
    </script>
    <script src = "checklist_script.js"></script>
  </body>
</html>
